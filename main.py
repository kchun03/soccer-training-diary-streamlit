import streamlit as st
from datetime import date
import sqlite3

# DB ì—°ê²° ë° í…Œì´ë¸” ìƒì„±
conn = sqlite3.connect("diary.db", check_same_thread=False)
cur = conn.cursor()
cur.execute("""
CREATE TABLE IF NOT EXISTS diary (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    diary_date TEXT,
    status TEXT,
    good TEXT,
    bad TEXT
)
""")
conn.commit()

st.title("âš½ ì´ìœ¤ì„± ì¶•êµ¬ í›ˆë ¨ ì¼ì§€")

# ğŸ“‹ ì¼ì§€ ì‘ì„± í¼
with st.form("entry_form"):
    diary_date = st.date_input("ë‚ ì§œ", value=date.today())
    status = st.selectbox("ì˜¤ëŠ˜ í›ˆë ¨ì€ ì–´ë• ë‚˜ìš”?", ["ì•„ì£¼ ì¢‹ì•˜ì–´ìš” ğŸ˜Š", "ê´œì°®ì•˜ì–´ìš” ğŸ™‚", "í˜ë“¤ì—ˆì–´ìš” ğŸ˜“", "ë³„ë¡œì˜€ì–´ìš” ğŸ˜"])
    good = st.text_area("ì˜í•œ ì ")
    bad = st.text_area("ëª»í•œ ì ")
    submitted = st.form_submit_button("ì‘ì„± ì™„ë£Œ")

    if submitted:
        cur.execute("INSERT INTO diary (diary_date, status, good, bad) VALUES (?, ?, ?, ?)",
                    (str(diary_date), status, good, bad))
        conn.commit()
        st.success("âœ… ì¼ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!")

# ğŸ“‹ ì¼ì§€ ëª©ë¡
st.markdown("---")
st.subheader("ğŸ“‹ ì‘ì„±ëœ í›ˆë ¨ ì¼ì§€")

cur.execute("SELECT * FROM diary ORDER BY diary_date DESC")
rows = cur.fetchall()

for row in rows:
    with st.expander(f"ğŸ“… {row[1]} - {row[2]}"):
        st.write(f"âœ… ì˜í•œ ì : {row[3]}")
        st.write(f"âŒ ëª»í•œ ì : {row[4]}")
        
        delete = st.button("ğŸ—‘ï¸ ì‚­ì œ", key=f"delete_{row[0]}")
        if delete:
            cur.execute("DELETE FROM diary WHERE id = ?", (row[0],))
            conn.commit()
            st.success(f"ì‚­ì œ ì™„ë£Œ: {row[1]} ì¼ì§€")
            st.rerun()  # ìµœì‹  Streamlitì—ì„œëŠ” ì´ í•¨ìˆ˜ë¡œ ìƒˆë¡œê³ ì¹¨
